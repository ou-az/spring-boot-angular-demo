<div class="container mt-4">
  <div class="row mb-3">
    <div class="col">
      <h2>{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h2>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-secondary" [routerLink]="['/products']">
        <i class="bi bi-arrow-left"></i> Back to List
      </button>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div *ngIf="loading" class="d-flex justify-content-center my-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
        <div class="mb-3">
          <label for="name" class="form-label">Product Name <span class="text-danger">*</span></label>
          <input 
            type="text" 
            formControlName="name" 
            class="form-control" 
            id="name"
            [ngClass]="{ 'is-invalid': submitted && f['name'].errors }"
          >
          <div *ngIf="submitted && f['name'].errors" class="invalid-feedback">
            <div *ngIf="f['name'].errors['required']">Product name is required</div>
            <div *ngIf="f['name'].errors['minlength']">Product name must be at least 3 characters</div>
            <div *ngIf="f['name'].errors['maxlength']">Product name cannot exceed 100 characters</div>
          </div>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
          <textarea 
            formControlName="description" 
            class="form-control" 
            id="description" 
            rows="4"
            [ngClass]="{ 'is-invalid': submitted && f['description'].errors }"
          ></textarea>
          <div *ngIf="submitted && f['description'].errors" class="invalid-feedback">
            <div *ngIf="f['description'].errors['required']">Description is required</div>
            <div *ngIf="f['description'].errors['minlength']">Description must be at least 10 characters</div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="price" class="form-label">Price ($) <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input 
                type="number" 
                formControlName="price" 
                class="form-control" 
                id="price" 
                min="0.01" 
                step="0.01"
                [ngClass]="{ 'is-invalid': submitted && f['price'].errors }"
              >
              <div *ngIf="submitted && f['price'].errors" class="invalid-feedback">
                <div *ngIf="f['price'].errors['required']">Price is required</div>
                <div *ngIf="f['price'].errors['min']">Price must be greater than $0.01</div>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <label for="category" class="form-label">Category <span class="text-danger">*</span></label>
            <select 
              formControlName="category" 
              class="form-select" 
              id="category"
              [ngClass]="{ 'is-invalid': submitted && f['category'].errors }"
            >
              <option value="" disabled>Select a category</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
            <div *ngIf="submitted && f['category'].errors" class="invalid-feedback">
              <div *ngIf="f['category'].errors['required']">Category is required</div>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="imageUrl" class="form-label">Image URL</label>
          <input 
            type="url" 
            formControlName="imageUrl" 
            class="form-control" 
            id="imageUrl" 
            placeholder="https://example.com/image.jpg"
          >
          <small class="text-muted">Enter a valid URL for the product image</small>
        </div>

        <div class="mb-4 form-check">
          <input 
            type="checkbox" 
            formControlName="available" 
            class="form-check-input" 
            id="available"
          >
          <label class="form-check-label" for="available">Product is available</label>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button 
            type="button" 
            class="btn btn-outline-secondary" 
            [routerLink]="['/products']" 
            [disabled]="loading"
          >
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="loading"
          >
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
            {{ isEditMode ? 'Update' : 'Create' }} Product
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
